<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QRã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼æ³¨æ–‡ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>QRã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼æ³¨æ–‡ã‚·ã‚¹ãƒ†ãƒ </h1>
        
        <div class="connection-panel">
            <button id="connect-button" class="primary-button"><i class="fas fa-plug"></i> QRã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ã«æ¥ç¶š</button>
            <div id="connection-status" class="status-indicator">æœªæ¥ç¶š</div>
            <!-- ä¸Šéƒ¨ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ã¾ã—ãŸ - ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã¿ã‚’ä½¿ç”¨ -->
        </div>
        
        <div class="order-status-panel">
            <h2><i class="fas fa-receipt"></i> æ³¨æ–‡çŠ¶æ³</h2>
            <div id="order-status" class="order-status">ãƒ†ãƒ¼ãƒ–ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</div>
            <div class="order-actions">
                <button id="reset-order" class="reset-button"><i class="fas fa-undo"></i> æ³¨æ–‡ãƒªã‚»ãƒƒãƒˆ</button>
                <button id="send-order" class="send-button"><i class="fas fa-paper-plane"></i> æ³¨æ–‡é€ä¿¡</button>
                <button id="debug-storage" class="reset-button" style="background-color: #6c757d;"><i class="fas fa-bug"></i> ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç¢ºèª</button>
            </div>
        </div>
        
        <div class="test-panel" id="test-panel">
            <h2><i class="fas fa-vial"></i> ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h2>
            <div class="test-buttons">
                <div class="table-selection">
                    <h3>ãƒ†ãƒ¼ãƒ–ãƒ«é¸æŠ</h3>
                    <div class="table-radio-group">
                        <label class="table-radio">
                            <input type="radio" name="table" value="TABLE01">
                            <span class="table-radio-label">ãƒ†ãƒ¼ãƒ–ãƒ«1</span>
                        </label>
                        <label class="table-radio">
                            <input type="radio" name="table" value="TABLE02">
                            <span class="table-radio-label">ãƒ†ãƒ¼ãƒ–ãƒ«2</span>
                        </label>
                        <label class="table-radio">
                            <input type="radio" name="table" value="TABLE03">
                            <span class="table-radio-label">ãƒ†ãƒ¼ãƒ–ãƒ«3</span>
                        </label>
                        <label class="table-radio">
                            <input type="radio" name="table" value="TABLE04">
                            <span class="table-radio-label">ãƒ†ãƒ¼ãƒ–ãƒ«4</span>
                        </label>
                        <label class="table-radio">
                            <input type="radio" name="table" value="TABLE05">
                            <span class="table-radio-label">ãƒ†ãƒ¼ãƒ–ãƒ«5</span>
                        </label>
                    </div>
                </div>
                
                <h3>å•†å“é¸æŠ</h3>
                <div class="product-buttons">
                    <button type="button" class="test-button" data-product-id="P001"><i class="fas fa-utensils"></i> é†¤æ²¹ãƒ©ãƒ¼ãƒ¡ãƒ³</button>
                    <button type="button" class="test-button" data-product-id="P002"><i class="fas fa-utensils"></i> å‘³å™Œãƒ©ãƒ¼ãƒ¡ãƒ³</button>
                    <button type="button" class="test-button" data-product-id="P003"><i class="fas fa-utensils"></i> å¡©ãƒ©ãƒ¼ãƒ¡ãƒ³</button>
                    <button type="button" class="test-button" data-product-id="P004"><i class="fas fa-utensils"></i> ã¨ã‚“ã“ã¤ãƒ©ãƒ¼ãƒ¡ãƒ³</button>
                    <button type="button" class="test-button" data-product-id="P005"><i class="fas fa-utensils"></i> ã¤ã‘éºº</button>
                    <button type="button" class="test-button" data-product-id="P006"><i class="fas fa-bowl-food"></i> ãƒãƒ£ãƒ¼ã‚·ãƒ¥ãƒ¼ä¸¼</button>
                    <button type="button" class="test-button" data-product-id="P007"><i class="fas fa-drumstick-bite"></i> é¤ƒå­</button>
                    <button type="button" class="test-button" data-product-id="P008"><i class="fas fa-beer"></i> ãƒ“ãƒ¼ãƒ«</button>
                </div>
            </div>
            <div class="test-description">
                <i class="fas fa-info-circle"></i> ã¾ãšãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é¸æŠã—ã€å•†å“ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æ³¨æ–‡ãŒè¿½åŠ ã•ã‚Œã¾ã™
            </div>
        </div>
        
        <div class="product-panel" id="product-panel">
            <h2><i class="fas fa-shopping-cart"></i> å•†å“æƒ…å ±</h2>
            <div id="product-container">
                <div class="product-placeholder"><i class="fas fa-camera"></i> QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚‹ã¨å•†å“æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
            </div>
        </div>
        
        <div class="log-panel">
            <h2><i class="fas fa-history"></i> æ“ä½œãƒ­ã‚°</h2>
            <div id="log-container"></div>
        </div>
    </div>
    
    <script src="products.js" type="module"></script>
    <script src="app.js" type="module"></script>
    <script src="navigation.js"></script>
    
    <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ­ã‚°è¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ« -->
    <style>
        .custom-log-entry {
            padding: 5px;
            margin: 3px 0;
            border-left: 3px solid #4CAF50;
            font-family: monospace;
        }
        .custom-log-info {
            border-left-color: #2196F3;
            background-color: rgba(33, 150, 243, 0.05);
        }
        .custom-log-error {
            border-left-color: #f44336;
            background-color: rgba(244, 67, 54, 0.05);
            color: #f44336;
        }
        .custom-log-success {
            border-left-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.05);
            color: #4CAF50;
        }
        .custom-log-heading {
            font-weight: bold;
            background-color: #f5f5f5;
            padding: 8px;
            margin-top: 10px;
            margin-bottom: 5px;
            border-left: 5px solid #3f51b5;
            color: #3f51b5;
        }
        .custom-log-subheading {
            font-weight: bold;
            margin-top: 8px;
            padding: 5px;
            border-bottom: 1px solid #eee;
            color: #666;
        }
        .custom-log-timestamp {
            color: #999;
            font-size: 0.85em;
            margin-right: 5px;
        }
        #log-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background-color: #fff;
            font-size: 14px;
        }
        
        /* æ³¨æ–‡çŠ¶æ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .current-order-header {
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        .current-order-header h3 {
            margin: 0 0 5px 0;
            color: #333;
            font-size: 16px;
        }
        .no-items, .no-table {
            color: #666;
            font-style: italic;
            padding: 10px 0;
        }
        .active-orders-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        .active-orders-section h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }
        .active-orders-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .active-order-item {
            margin-bottom: 10px;
            padding: 8px 10px;
            border-radius: 4px;
            background-color: #f9f9f9;
            border-left: 3px solid #4CAF50;
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .order-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .order-id {
            font-weight: bold;
            color: #333;
        }
        .order-table {
            color: #666;
        }
        .order-date {
            color: #999;
            font-size: 0.9em;
        }
        .order-items-count {
            color: #666;
        }
        .order-amount {
            font-weight: bold;
            color: #333;
        }
        .order-status {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            color: white;
        }
        .status-received {
            background-color: #2196F3; /* é’ */
        }
        .status-preparing {
            background-color: #FF9800; /* ã‚ªãƒ¬ãƒ³ã‚¸ */
        }
        .status-ready {
            background-color: #4CAF50; /* ç·‘ */
        }
        .status-serving {
            background-color: #9C27B0; /* ç´« */
        }
    </style>

    <!-- ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ã®ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å¤–éƒ¨ã«é…ç½®ï¼‰ -->
    <script>
        // ä¿å­˜æ™‚åˆ»ã®è¿½è·¡ç”¨
        let lastStorageSave = {
            currentOrder: null,
            currentOrder_backup: null,
            orders: null
        };
        
        // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å¤‰æ›´ã‚’ç›£è¦–
        window.addEventListener('storage', function(e) {
            console.log('ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å¤‰æ›´æ¤œçŸ¥:', e.key);
            if (e.key === 'currentOrder' || e.key === 'currentOrder_backup' || e.key === 'orders') {
                lastStorageSave[e.key] = new Date();
            }
        });
        
        // ãƒšãƒ¼ã‚¸ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸå¾Œã«ãƒ‡ãƒãƒƒã‚°ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
        document.addEventListener('DOMContentLoaded', function() {
            const debugButton = document.getElementById('debug-storage');
            const logContainer = document.getElementById('log-container');
            
            if (debugButton) {
                console.log('ãƒ‡ãƒãƒƒã‚°ãƒœã‚¿ãƒ³ã«ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ ');
                
                debugButton.addEventListener('click', function() {
                    console.log('ãƒ‡ãƒãƒƒã‚°ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸï¼ˆã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ï¼‰');
                    console.log('logContainerå­˜åœ¨ç¢ºèª:', logContainer ? 'ã‚ã‚Š' : 'ãªã—');
                    
                    if (logContainer) {
                        console.log('ãƒ­ã‚°ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¯ãƒªã‚¢é–‹å§‹');
                        // ãƒ­ã‚°ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¯ãƒªã‚¢
                        logContainer.innerHTML = '';
                        console.log('ãƒ­ã‚°ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¯ãƒªã‚¢å®Œäº†');
                        
                        // consoleã«ãƒ­ã‚°ã‚³ãƒ³ãƒ†ãƒŠã®æƒ…å ±ã‚’è©³ç´°ã«è¡¨ç¤º
                        console.log('ãƒ­ã‚°ã‚³ãƒ³ãƒ†ãƒŠè©³ç´°:', {
                            tagName: logContainer.tagName,
                            id: logContainer.id,
                            className: logContainer.className,
                            innerHTML: logContainer.innerHTML,
                            style: {
                                display: window.getComputedStyle(logContainer).display,
                                visibility: window.getComputedStyle(logContainer).visibility,
                                height: window.getComputedStyle(logContainer).height,
                                width: window.getComputedStyle(logContainer).width
                            }
                        });
                        
                        // æ™‚åˆ»ä»˜ãã§ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
                        function addLogEntry(message, type) {
                            console.log(`ãƒ­ã‚°è¿½åŠ (${type}): ${message}`);
                            const entry = document.createElement('div');
                            entry.className = `custom-log-entry custom-log-${type || 'info'}`;
                            
                            const timestamp = document.createElement('span');
                            timestamp.className = 'custom-log-timestamp';
                            timestamp.textContent = new Date().toLocaleTimeString();
                            
                            const content = document.createElement('span');
                            content.textContent = message;
                            
                            entry.appendChild(timestamp);
                            entry.appendChild(content);
                            logContainer.appendChild(entry);
                            
                            // è¿½åŠ å¾Œã«å†åº¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’å‡ºåŠ›
                            console.log('ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªè¿½åŠ å¾Œã®HTML:', logContainer.innerHTML);
                            
                            return entry;
                        }
                        
                        // è¦‹å‡ºã—ã‚’è¿½åŠ 
                        function addHeading(text) {
                            console.log(`è¦‹å‡ºã—è¿½åŠ : ${text}`);
                            const heading = document.createElement('div');
                            heading.className = 'custom-log-heading';
                            heading.textContent = text;
                            logContainer.appendChild(heading);
                            return heading;
                        }
                        
                        // ã‚µãƒ–è¦‹å‡ºã—ã‚’è¿½åŠ 
                        function addSubHeading(text) {
                            console.log(`ã‚µãƒ–è¦‹å‡ºã—è¿½åŠ : ${text}`);
                            const subheading = document.createElement('div');
                            subheading.className = 'custom-log-subheading';
                            subheading.textContent = text;
                            logContainer.appendChild(subheading);
                            return subheading;
                        }
                        
                        try {
                            console.log('ãƒ‡ãƒ¼ã‚¿å‡¦ç†é–‹å§‹ï¼');
                            addHeading('ğŸ“Š ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ç¢ºèª');
                            addLogEntry('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚’é–‹å§‹ã—ã¾ã™', 'info');
                            
                            // localStorage ã‹ã‚‰ç›´æ¥ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                            console.log('localStorage ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹');
                            const keys = ['currentOrder', 'currentOrder_backup', 'currentOrder_check', 'orders'];
                            const storageData = {};
                            
                            console.log('localStorage keys:', Object.keys(localStorage));
                            
                            for (let i = 0; i < localStorage.length; i++) {
                                const key = localStorage.key(i);
                                console.log(`localStorage[${i}]: ${key}`);
                            }
                            
                            keys.forEach(key => {
                                console.log(`-------- ã‚­ãƒ¼: ${key} ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†é–‹å§‹ --------`);
                                try {
                                    console.log(`localStorage.getItem('${key}') å®Ÿè¡Œ...`);
                                    const rawData = localStorage.getItem(key);
                                    console.log(`${key} ã®ç”Ÿãƒ‡ãƒ¼ã‚¿:`, rawData ? (rawData.length > 100 ? rawData.substring(0, 100) + '...' : rawData) : 'null');
                                    
                                    let parsedData = null;
                                    if (rawData) {
                                        console.log(`${key} ã®JSONãƒ‘ãƒ¼ã‚¹é–‹å§‹`);
                                        parsedData = JSON.parse(rawData);
                                        console.log(`${key} ã®ãƒ‘ãƒ¼ã‚¹æˆåŠŸ:`, parsedData);
                                    }
                                    
                                    storageData[key] = {
                                        exists: !!rawData,
                                        raw: rawData,
                                        parsed: parsedData,
                                        lastSaved: lastStorageSave[key] || null
                                    };
                                    console.log(`${key} ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†å®Œäº†:`, storageData[key].exists ? 'å­˜åœ¨ã—ã¾ã™' : 'å­˜åœ¨ã—ã¾ã›ã‚“');
                                } catch (e) {
                                    console.error(`${key} ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼:`, e);
                                    storageData[key] = { 
                                        exists: false, 
                                        error: e.message 
                                    };
                                }
                                console.log(`-------- ã‚­ãƒ¼: ${key} ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†å®Œäº† --------`);
                            });
                            
                            console.log('å…¨ã‚­ãƒ¼ã®å‡¦ç†å®Œäº†ã€ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºé–‹å§‹');
                            
                            // ç¾åœ¨ã®æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
                            addSubHeading('ã€ç¾åœ¨ã®æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã€‘');
                            if (storageData.currentOrder.exists) {
                                const data = storageData.currentOrder.parsed;
                                const savedTime = storageData.currentOrder.lastSaved;
                                
                                if (savedTime) {
                                    addLogEntry(`æœ€çµ‚ä¿å­˜: ${savedTime.toLocaleString()}`, 'info');
                                }
                                
                                addLogEntry(`ãƒ†ãƒ¼ãƒ–ãƒ«ç•ªå·: ${data.tableId || 'ãªã—'}`, 'info');
                                addLogEntry(`å•†å“æ•°: ${data.items ? data.items.length : 0}ã‚¢ã‚¤ãƒ†ãƒ `, 'info');
                                
                                if (data.items && data.items.length > 0) {
                                    addLogEntry('ç™»éŒ²å•†å“ä¸€è¦§:', 'info');
                                    data.items.forEach((item, index) => {
                                        addLogEntry(`  ${index+1}. ${item.name} - Â¥${item.price.toLocaleString()}`, 'info');
                                    });
                                    
                                    // åˆè¨ˆé‡‘é¡ã‚‚è¡¨ç¤º
                                    const total = data.items.reduce((sum, item) => sum + item.price, 0);
                                    addLogEntry(`åˆè¨ˆé‡‘é¡: Â¥${total.toLocaleString()}`, 'success');
                                } else {
                                    addLogEntry('ç™»éŒ²å•†å“ãªã—', 'info');
                                }
                            } else {
                                addLogEntry('ç¾åœ¨ã®æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                            }
                            
                            // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
                            addSubHeading('ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã€‘');
                            if (storageData.currentOrder_backup.exists) {
                                const data = storageData.currentOrder_backup.parsed;
                                const savedTime = storageData.currentOrder_backup.lastSaved;
                                
                                if (savedTime) {
                                    addLogEntry(`æœ€çµ‚ä¿å­˜: ${savedTime.toLocaleString()}`, 'info');
                                }
                                
                                addLogEntry(`ãƒ†ãƒ¼ãƒ–ãƒ«ç•ªå·: ${data.tableId || 'ãªã—'}`, 'info');
                                addLogEntry(`å•†å“æ•°: ${data.items ? data.items.length : 0}ã‚¢ã‚¤ãƒ†ãƒ `, 'info');
                            } else {
                                addLogEntry('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                            }
                            
                            // ä¿å­˜æ¸ˆã¿æ³¨æ–‡ä¸€è¦§ã‚’è¡¨ç¤º
                            addSubHeading('ã€ä¿å­˜æ¸ˆã¿æ³¨æ–‡ä¸€è¦§ã€‘');
                            if (storageData.orders.exists) {
                                const orders = storageData.orders.parsed;
                                addLogEntry(`ç™»éŒ²æ¸ˆã¿æ³¨æ–‡æ•°: ${orders.length}ä»¶`, 'success');
                                
                                if (orders.length > 0) {
                                    // æœ€æ–°5ä»¶ã®æ³¨æ–‡ã‚’è¡¨ç¤º
                                    addLogEntry('æœ€æ–°ã®æ³¨æ–‡:', 'info');
                                    const recentOrders = orders.slice(-5);
                                    
                                    recentOrders.forEach((order, index) => {
                                        const date = new Date(order.createdAt || order.timestamp).toLocaleString();
                                        const items = order.items ? order.items.length : 0;
                                        const total = order.totalAmount ? `Â¥${order.totalAmount.toLocaleString()}` : 'ä¸æ˜';
                                        
                                        addLogEntry(
                                            `[${date}] ID:${order.id.slice(-6)}, ` + 
                                            `ãƒ†ãƒ¼ãƒ–ãƒ«:${order.tableId}, å•†å“æ•°:${items}, ` + 
                                            `é‡‘é¡:${total}, çŠ¶æ…‹:${order.status}`, 
                                            'info'
                                        );
                                    });
                                }
                            } else {
                                addLogEntry('æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                            }
                            
                            // åŒæœŸçŠ¶æ…‹ã®ãƒã‚§ãƒƒã‚¯
                            addSubHeading('ã€ãƒ‡ãƒ¼ã‚¿ã®åŒæœŸçŠ¶æ…‹ã€‘');
                            // currentOrderã¨backupã®ãƒ‡ãƒ¼ã‚¿ãŒä¸€è‡´ã™ã‚‹ã‹ç¢ºèª
                            if (storageData.currentOrder.exists && storageData.currentOrder_backup.exists) {
                                const mainData = JSON.stringify(storageData.currentOrder.parsed);
                                const backupData = JSON.stringify(storageData.currentOrder_backup.parsed);
                                
                                if (mainData === backupData) {
                                    addLogEntry('ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯åŒæœŸã—ã¦ã„ã¾ã™ âœ“', 'success');
                                } else {
                                    addLogEntry('ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“ âš ', 'error');
                                }
                            }
                            
                            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ä¸€ç•ªä¸‹ã«
                            logContainer.scrollTop = logContainer.scrollHeight;
                            
                            addLogEntry('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†', 'success');
                        } catch (error) {
                            console.error('ãƒ‡ãƒãƒƒã‚°å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ:', error);
                            addLogEntry(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`, 'error');
                        }
                    } else {
                        console.error('ãƒ­ã‚°ã‚³ãƒ³ãƒ†ãƒŠãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    }
                });
                
                // åˆæœŸçŠ¶æ…‹ã§ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
                console.log('è‡ªå‹•ã‚¯ãƒªãƒƒã‚¯ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’è¨­å®š...');
                setTimeout(() => {
                    console.log('è‡ªå‹•ã‚¯ãƒªãƒƒã‚¯å®Ÿè¡Œï¼');
                    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«è‡ªå‹•çš„ã«ã‚¯ãƒªãƒƒã‚¯
                    debugButton.click();
                    
                    // UIè¡¨ç¤ºãŒã•ã‚Œã¦ã„ãªã„å ´åˆã€å†åº¦ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚’å¼·åˆ¶çš„ã«è©¦ã¿ã‚‹
                    console.log('æ³¨æ–‡çŠ¶æ…‹ã®è¡¨ç¤ºã‚’ç¢ºèªã—ã¾ã™...');
                    setTimeout(() => {
                        const orderStatusElement = document.getElementById('order-status');
                        if (orderStatusElement) {
                            const currentContent = orderStatusElement.innerHTML;
                            console.log('ç¾åœ¨ã®æ³¨æ–‡çŠ¶æ…‹è¡¨ç¤º:', currentContent);
                            
                            // ã¾ã ãƒ†ãƒ¼ãƒ–ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ãªã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¦ã€
                            // ã‹ã¤localStorageã«ã¯æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯å¼·åˆ¶çš„ã«å†èª­ã¿è¾¼ã¿
                            if ((currentContent === 'ãƒ†ãƒ¼ãƒ–ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“' || !orderStatusElement.classList.contains('has-table')) 
                                && localStorage.getItem('currentOrder')) {
                                console.log('æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å¼·åˆ¶çš„ã«å†è¡¨ç¤ºã‚’è©¦ã¿ã¾ã™...');
                                
                                // app.jsã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã§ã€æ³¨æ–‡å¾©å…ƒé–¢æ•°ã‚’å‘¼ã³å‡ºã™
                                if (typeof window.restoreCurrentOrderFromGlobal === 'function') {
                                    console.log('ã‚°ãƒ­ãƒ¼ãƒãƒ«ã®å¾©å…ƒé–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™');
                                    window.restoreCurrentOrderFromGlobal();
                                } else if (typeof restoreCurrentOrder === 'function') {
                                    console.log('restoreCurrentOrderé–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™');
                                    restoreCurrentOrder();
                                } else {
                                    console.log('ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«restoreCurrentOrderé–¢æ•°ãŒã‚ã‚Šã¾ã›ã‚“');
                                    // ç›´æ¥çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ï¼ˆç·Šæ€¥æ™‚ã®å¯¾å¿œç­–ï¼‰
                                    try {
                                        let statusHtml = '';
                                        
                                        // 1. ç¾åœ¨ã®æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒ
                                        const savedData = JSON.parse(localStorage.getItem('currentOrder'));
                                        console.log('ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥è¡¨ç¤º:', savedData);
                                        
                                        if (savedData && savedData.tableId) {
                                            // ãƒ˜ãƒƒãƒ€ãƒ¼è¡¨ç¤º
                                            statusHtml += `<div class="current-order-header">
                                                <h3>ç¾åœ¨ã®æ³¨æ–‡å†…å®¹</h3>
                                                <div>ãƒ†ãƒ¼ãƒ–ãƒ«: ${savedData.tableId} - å•†å“æ•°: ${savedData.items ? savedData.items.length : 0}</div>
                                            </div>`;
                                            
                                            orderStatusElement.classList.add('has-table');
                                            
                                            // ãƒ†ãƒ¼ãƒ–ãƒ«é¸æŠãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚’æ›´æ–°
                                            const tableRadio = document.querySelector(`input[name="table"][value="${savedData.tableId}"]`);
                                            if (tableRadio) {
                                                tableRadio.checked = true;
                                            }
                                            
                                            // å•†å“æƒ…å ±ãŒã‚ã‚‹å ´åˆã¯è¡¨ç¤º
                                            if (savedData.items && savedData.items.length > 0) {
                                                const itemsHtml = savedData.items.map((item, index) => {
                                                    return `
                                                        <div class="order-item">
                                                            <span>${index + 1}. ${item.name} - Â¥${item.price ? item.price.toLocaleString() : 0}</span>
                                                        </div>
                                                    `;
                                                }).join('');
                                                
                                                // åˆè¨ˆé‡‘é¡è¨ˆç®—
                                                const total = savedData.items.reduce((sum, item) => sum + (item.price || 0), 0);
                                                
                                                statusHtml += `
                                                    <div class="order-items-list">
                                                        ${itemsHtml}
                                                        <div class="order-total">
                                                            åˆè¨ˆ: Â¥${total.toLocaleString()}
                                                        </div>
                                                    </div>
                                                `;
                                            } else {
                                                statusHtml += '<div class="no-items">æ³¨æ–‡å•†å“ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                                            }
                                        } else {
                                            statusHtml = '<div class="no-table">ãƒ†ãƒ¼ãƒ–ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</div>';
                                        }
                                        
                                        // 2. æ³¨æ–‡å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤º
                                        try {
                                            const ordersData = localStorage.getItem('orders');
                                            if (ordersData) {
                                                const orders = JSON.parse(ordersData);
                                                
                                                // é€²è¡Œä¸­ã®æ³¨æ–‡ã®ã¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                                                const activeOrders = orders.filter(order => 
                                                    order.status !== 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«' && order.status !== 'æä¾›æ¸ˆã¿'
                                                );
                                                
                                                if (activeOrders.length > 0) {
                                                    console.log(`é€²è¡Œä¸­ã®æ³¨æ–‡ãŒ ${activeOrders.length} ä»¶è¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆç·Šæ€¥å¾©å…ƒï¼‰`);
                                                    
                                                    // é€²è¡Œä¸­ã®æ³¨æ–‡ã‚»ã‚¯ã‚·ãƒ§ãƒ³
                                                    statusHtml += `
                                                        <div class="active-orders-section">
                                                            <h3>é€²è¡Œä¸­ã®æ³¨æ–‡ (${activeOrders.length}ä»¶)</h3>
                                                            <div class="active-orders-list">
                                                    `;
                                                    
                                                    // å„æ³¨æ–‡ã®è©³ç´°
                                                    activeOrders.forEach(order => {
                                                        const orderDate = new Date(order.createdAt || order.timestamp).toLocaleString('ja-JP', {
                                                            month: 'numeric',
                                                            day: 'numeric',
                                                            hour: '2-digit',
                                                            minute: '2-digit'
                                                        });
                                                        
                                                        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¯ãƒ©ã‚¹
                                                        let statusClass = '';
                                                        switch(order.status) {
                                                            case 'å—ä»˜': statusClass = 'status-received'; break;
                                                            case 'æº–å‚™ä¸­': statusClass = 'status-preparing'; break;
                                                            case 'æº–å‚™å®Œäº†': statusClass = 'status-ready'; break;
                                                            case 'é…è†³ä¸­': statusClass = 'status-serving'; break;
                                                        }
                                                        
                                                        statusHtml += `
                                                            <div class="active-order-item">
                                                                <div class="order-header">
                                                                    <span class="order-id">${order.id.substring(0, 8)}</span>
                                                                    <span class="order-table">ãƒ†ãƒ¼ãƒ–ãƒ« ${order.tableId}</span>
                                                                    <span class="order-date">${orderDate}</span>
                                                                </div>
                                                                <div class="order-detail">
                                                                    <span class="order-items-count">å•†å“: ${order.items.length}ç‚¹</span>
                                                                    <span class="order-amount">Â¥${order.totalAmount ? order.totalAmount.toLocaleString() : 'ä¸æ˜'}</span>
                                                                    <span class="order-status ${statusClass}">${order.status}</span>
                                                                </div>
                                                            </div>
                                                        `;
                                                    });
                                                    
                                                    statusHtml += `
                                                            </div>
                                                        </div>
                                                    `;
                                                } else {
                                                    console.log('é€²è¡Œä¸­ã®æ³¨æ–‡ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆç·Šæ€¥å¾©å…ƒï¼‰');
                                                }
                                            } else {
                                                console.log('æ³¨æ–‡å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆç·Šæ€¥å¾©å…ƒï¼‰');
                                            }
                                        } catch (e) {
                                            console.error('æ³¨æ–‡å±¥æ­´ã®å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼:', e);
                                        }
                                        
                                        // HTMLã®è¨­å®š
                                        orderStatusElement.innerHTML = statusHtml;
                                        console.log('ç·Šæ€¥å¾©å…ƒå®Œäº†ï¼');
                                    } catch (e) {
                                        console.error('ç·Šæ€¥ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºä¸­ã«ã‚¨ãƒ©ãƒ¼:', e);
                                    }
                                }
                            }
                        }
                    }, 500); // 500mså¾Œã«ç¢ºèª
                }, 1000);
                
                // ç›´æ¥å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ç·Šæ€¥å¯¾ç­–
                console.log('ç·Šæ€¥å¯¾ç­–: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«localStorageã®å†…å®¹ã‚’ç›´æ¥å‡ºåŠ›');
                try {
                    console.log('===== localStorage ç›´æ¥ãƒã‚§ãƒƒã‚¯ =====');
                    
                    // ã™ã¹ã¦ã®localStorageé …ç›®ã‚’è¡¨ç¤º
                    console.log('- ã™ã¹ã¦ã®ä¿å­˜ã‚­ãƒ¼:');
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        const value = localStorage.getItem(key);
                        console.log(`  ${key}: ${value ? (value.length > 50 ? value.substring(0, 50) + '...' : value) : 'null'}`);
                    }
                    
                    // ç‰¹å®šã®ã‚­ãƒ¼ã‚’è©³ç´°ã«è¡¨ç¤º
                    const currentOrderData = localStorage.getItem('currentOrder');
                    console.log('- currentOrder:', currentOrderData ? 
                        JSON.parse(currentOrderData) : 'ãƒ‡ãƒ¼ã‚¿ãªã—');
                    
                    const ordersData = localStorage.getItem('orders');
                    if (ordersData) {
                        const orders = JSON.parse(ordersData);
                        console.log(`- orders: ${orders.length}ä»¶ã®æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿`);
                        if (orders.length > 0) {
                            console.log('  æœ€æ–°ã®æ³¨æ–‡:', orders[orders.length - 1]);
                        }
                    } else {
                        console.log('- orders: ãƒ‡ãƒ¼ã‚¿ãªã—');
                    }
                } catch (e) {
                    console.error('ç·Šæ€¥å‡ºåŠ›ä¸­ã«ã‚¨ãƒ©ãƒ¼:', e);
                }
            } else {
                console.error('ãƒ‡ãƒãƒƒã‚°ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        });
    </script>
</body>
</html>